# PBR
`Цель:`
Настроить политику маршрутизации в офисе Чокурдах
Распределить трафик между 2 линками

# Задание:
- `Часть1:` Настроить политику маршрутизации для сетей офиса Чокурдах.
- `Часть2:` Распределить трафик между двумя линками с провайдером.
- `Часть3:` Настроить отслеживание линка через технологию IP SLA.(только для IPv4)
- `Часть4:` Настроить для офиса Лабытнанги маршрут по-умолчанию.
<br><br>
- ## Часть 1 и 2. Настройка политики маршрутизации для сетей офиса Чокурдах и Распределение трафика между двумя линками с провайдером.

В офисе Чокурдах расположено два объекта в двух разных VLAN'ах: VPC30 и VPC31
Маршрутизатор  R28 имеет два линка от провайдера, поэтому целесообразно разделить трафик VLAN2(VPC30) и VLAN3(VPС31) между ними.
Для этого создадим на R28 два Access-List'а с разрешением доступа для наших машин VPC:
 ~~~
ip access-list extended VPC30 //в нашем случае можно использовать и standart access-list (только для IPv4)
 permit ip host 192.168.2.1 any
ip access-list extended VPC31
 permit ip host 192.168.3.1 any
 ~~~
Для распределения трафика между двумя линками настроим карту маршрута:
~~~
!
route-map BALLANCE permit 10 
 match ip address VPC30
 set ip next-hop 10.0.0.1 //в сторону R26
!
route-map BALLANCE permit 20
 match ip address VPC31
 set ip next-hop 10.0.1.1 //в сторону R25
!
~~~
Таким образом мы получили "пути" для трафика из VLAN2 на маршрутизатор R26, а из VLAN3 на маршрутизатор R25

# !!! Важно отметить, что для вступления в силу route-map на нужных нам интерфейсах  (в нашем случае eth0/2.2 и eth0/2.3) необходимо выполнить команду:
~~~
ip policy route-map BALLANCE
~~~

- ## Часть 3. Настройка отслеживания линка через технологию IP SLA.(только для IPv4)

Самым оптимальным решением является проверка состяния линков от провайдера командой PING. 
Создадим задание для маршрутизатора R28, которое будет "заставлять" маршрутизатор проверять доступность каналов каждые 5 секунд:

~~~
ip sla 1 //обозначаем правило SLA
 icmp-echo 10.0.0.1 source-ip 10.0.0.2 //указываем выполняемую команду  ping  и порт, с которого команда должна выполняться
 frequency 5 //задаем периодичность проверки доступности
ip sla schedule 1 life forever start-time now //выставляем тайминги работы сервиса (работать всегда, запуститься немедленно)
ip sla 2
 icmp-echo 10.0.1.1 source-ip 10.0.1.2
 frequency 5
ip sla schedule 2 life forever start-time now
!
~~~
Проверим работу нашего задания: <br>
![](https://github.com/Samurai1135/otus-network-engeneer/blob/4de5fb53ce74a350d14e038d26c05e56d9d30a0c/Lab-05/Screenshots/stat.png)
